#!/usr/bin/env node

const fs = require("fs");

const commitMsgFile = process.argv[2];
const commitMsg = fs.readFileSync(commitMsgFile, "utf8").split("\n")[0];

const pattern = /^(feat|fix|test|bench|docs|chore|refactor|perf)\((backend|frontend|tools|ci|common).*\): /;

if (!pattern.test(commitMsg)) {
  console.error("[!] Commit message does not follow the required format.\n");
  console.error("Expected:");
  console.error("  <type>(<scope>): <message>\n");
  console.error("Where:");
  console.error("  type  = feat | fix | test | bench | docs | chore | refactor | perf");
  console.error("  scope = backend | frontend | tools | ci | common\n");
  console.error("Example:");
  console.error("  fix(backend): handle null user id\n");
  console.error("Your message:");
  console.error(`  ${commitMsg}`);
  process.exit(1);
}

process.exit(0);
